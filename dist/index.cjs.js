"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react/jsx-runtime"),s=require("react"),o=require("firebase/database"),F=require("firebase/app"),X=require("firebase/storage"),O=require("firebase/firestore"),j=require("lucide-react"),P=l=>s.useMemo(()=>{if(!(l!=null&&l.apiKey))throw new Error("Missing Firebase configuration");const c=F.getApps().length?F.getApp():F.initializeApp(l),a=o.getDatabase(c),g=X.getStorage(c),r=o.getDatabase(c),m=O.getFirestore(c);return console.log("✅ Firebase initialized:",c.name),{app:c,database:a,storage:g,realtimeDb:r,firestoreDb:m}},[l]);async function W(l=!1){try{const n=await fetch(`https://touch-a-life-dev.web.app/api/v1/talradio/channels?includeAll=${l}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return await n.json()}catch(n){throw console.error("Error fetching channels:",n),n}}function I(l=null){switch(l){case"telugu":return"telugu";case"hindi":return"hindi";case"talradio":return"english";case"kannada":return"kannada";default:return"all"}}const k="data:image/jpeg;base64,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",H=({src:l,fallback:n=k,alt:c="image",className:a,style:g})=>{const[r,m]=s.useState(l||n),[b,x]=s.useState(!1);s.useEffect(()=>{l?(m(l),x(!1)):m(n)},[l,n]);const B=()=>{r!==n&&m(n)};return t.jsx("img",{src:r,alt:c,onError:B,onLoad:()=>x(!0),className:`${a||""} ${b?"opacity-100":"opacity-0"} transition-opacity duration-500`,style:g,loading:"lazy"})},Z=()=>{const[l,n]=s.useState(new Date().getSeconds()),[c,a]=s.useState(new Date);s.useEffect(()=>{const f=setInterval(()=>{const E=new Date;n(E.getSeconds()),E.getSeconds()===0&&a(E)},1e3);return()=>clearInterval(f)},[]);const g=s.useMemo(()=>c.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),[c]),r=s.useMemo(()=>c.toLocaleDateString("en-US",{weekday:"short",day:"2-digit",month:"short",year:"numeric"}),[c]),[m,b]=g.split(" "),[x,B]=m.split(":");return t.jsxs("div",{className:"flex justify-between items-center mt-2 text-[11px] text-gray-500 font-mono",children:[t.jsx("span",{children:r}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),t.jsxs("div",{className:"flex items-baseline text-gray-700 font-semibold",children:[t.jsx("span",{children:x}),t.jsx("span",{className:"mx-[2px] text-gray-700 animate-[pulse_2s_ease-in-out_infinite]",style:{animationName:"pulse",animationDuration:"2s",animationIterationCount:"infinite",animationTimingFunction:"ease-in-out"},children:":"}),t.jsx("span",{children:B}),t.jsx("span",{children:":"}),t.jsx("span",{className:"ml-1 text-[10px] text-gray-600",children:l.toString().padStart(2,"0")}),t.jsx("span",{className:"ml-1 text-[10px] opacity-80",children:b})]})]}),t.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
          }
        `})]})},J=({firebaseConfig:l})=>{var S;const[n,c]=s.useState(!1),[a,g]=s.useState(null),[r,m]=s.useState([]),[b,x]=s.useState(""),B=s.useRef(null),f=s.useRef(null),E=s.useRef(null),N=s.useRef(null),{realtimeDb:h,database:$}=P(l),L=e=>{x(I(e)),g(e)};console.log("Audio SRC:",(S=f.current)==null?void 0:S.src);const[_,ee]=s.useState(!1),[p,T]=s.useState(.5),[v,K]=s.useState(!1),[y,Y]=s.useState(null),[i,U]=s.useState(null),[q,w]=s.useState(!1),Q=s.useRef(null),D=async e=>{const A=f.current;if(!A||!(i!=null&&i.downloadUrl))return;A.load(),A.src=i.downloadUrl;const u=()=>{n&&A.play().catch(d=>{console.error("Audio play failed:",d)})};if(e)try{const d=o.ref(h,`/seekTime/${a}`),R=await o.get(d);if(R.exists()&&n){const C=R.val();A.currentTime=C||0,u()}}catch(d){console.error("Error fetching seek time:",d)}else A.currentTime=0,u()};s.useEffect(()=>{f.current&&(f.current.volume=p)},[p]);const V=()=>{const e=f.current;e&&(e.src="",e.currentTime=0,n&&e.pause()),c(!1)},z=e=>{if(!e||!(r!=null&&r.length))return;const A=r.find(d=>d.name===e);if(!(A!=null&&A.name))return;const u=o.ref(h,`/currentStreaming/${A.name}`);y&&o.off(y),o.onValue(u,d=>{d.exists()?U(d.val()):(U({title:"Offline",thumbnailUrl:""}),V())}),Y(u)};console.log("LiveRadioWidget",N,E),s.useEffect(()=>{if(!(i!=null&&i.downloadUrl))return;const e=E.current!==i.downloadUrl,A=N.current!==a;D(A?!0:!e),E.current=i.downloadUrl,N.current=a},[i]);const G=()=>{w(!0),W().then(e=>{w(!1),Array.isArray(e==null?void 0:e.data)&&e.data.length>0&&m(e.data)}).catch(e=>{w(!1)})},M=()=>{let e="";a||((r==null?void 0:r.length)>0&&r.forEach(A=>{A.isDefault&&(e=A.name)}),x(I(e)),e&&g(e))};return s.useEffect(()=>{a&&z(a)},[a]),s.useEffect(()=>((r==null?void 0:r.length)>0?M():G(),()=>{y&&o.off(y);const e=f.current;e&&n&&e.pause()}),[]),s.useEffect(()=>{(r==null?void 0:r.length)>0&&M()},[r]),s.useEffect(()=>{const e=f.current;if(!e||!a)return;const A=Math.random().toString(36).slice(2,10);if(Q.current=A,n){if(D(!0),!a||a==="null"||a==="undefined"){console.warn("⚠️ Skipping invalid channel for listener registration:",a);return}const u=o.ref(h,`/talRadioCurrentListeners/${a}/${A}`);o.set(u,{timestamp:Date.now(),platform:"web"}).catch(C=>console.error("Failed to set listener:",C)),o.onDisconnect(u).remove();const d=o.ref(h,"/talRadioListenersCount/totalListeners"),R=o.ref(h,`/talRadioListenersCount/totalChannelListeners/${a}`);o.runTransaction(d,C=>(C||0)+1),o.runTransaction(R,C=>(C||0)+1)}else if(e.pause(),Q.current&&a){const u=o.ref(h,`/talRadioCurrentListeners/${a}/${Q.current}`);o.remove(u).catch(()=>{})}return()=>{if(!a||!Q.current)return;const u=o.ref(h,`/talRadioCurrentListeners/${a}/${Q.current}`);o.remove(u).catch(()=>{})}},[n,a]),s.useEffect(()=>{const e=f.current;e&&(e.volume=p)},[p]),s.useEffect(()=>{B.current&&B.current.style.setProperty("--fill",`${p*100}%`)},[p]),s.useEffect(()=>{const e=A=>{if(n){const u=Q.current;if(u){const d=o.ref(h,`/talRadioCurrentListeners/${a}/${u}`);o.remove(d).catch(R=>console.error("Error removing listener:",R))}A.preventDefault(),A.returnValue=""}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[n,a]),t.jsxs("div",{className:"tal-radio-container",children:[t.jsx("div",{className:"tal-header",children:t.jsxs("h2",{className:"tal-header-title",children:[t.jsx(j.Radio,{className:"radio-icon"}),"TALRadio – Listen, Feel and Act!"]})}),t.jsx("div",{className:"tal-channel-box",children:q?t.jsx("div",{className:"text-xs",children:"Loading languages..."}):t.jsx("div",{style:{display:"flex"},children:["talradio","hindi","telugu","kannada"].map(e=>t.jsx("button",{onClick:()=>L(e),className:`tal-channel-btn ${a===e?"active":""}`,children:e==="talradio"?"English":e.charAt(0).toUpperCase()+e.slice(1)},e))})}),t.jsxs("h3",{className:"tal-title",children:[t.jsx(j.Music,{className:"music-icon"}),t.jsx("span",{children:(i==null?void 0:i.title)||"Now Playing"})]}),t.jsxs("div",{className:"tal-main",children:[t.jsxs("div",{className:"tal-thumb",children:[t.jsx(H,{src:i==null?void 0:i.thumbnailUrl}),n&&t.jsx("div",{className:"tal-equalizer",children:[0,1,2,3].map(e=>t.jsx("div",{style:{animationDelay:`${e*.15}s`}},e))})]}),t.jsxs("div",{className:"tal-details",children:[t.jsxs("p",{className:"tal-meta",children:["Producer: ",(i==null?void 0:i.producer)||"Unknown"]}),t.jsxs("p",{className:"tal-meta",children:["RJ: ",(i==null?void 0:i.rjUserId)||"Unknown"]}),t.jsxs("div",{className:"tal-controls",children:[n?t.jsx("button",{onClick:()=>c(!1),className:"tal-circle-btn pause",children:t.jsx(j.Pause,{className:"tal-icon"})}):t.jsx("button",{onClick:()=>c(!0),className:"tal-circle-btn play",children:t.jsx(j.Play,{className:"tal-icon"})}),t.jsx("button",{onClick:()=>K(!v),className:"tal-mute-btn",children:v?t.jsx(j.VolumeX,{className:"volume-icon"}):t.jsx(j.Volume2,{cclassName:"volume-icon"})}),t.jsx("input",{ref:B,type:"range",min:0,max:1,step:.01,value:p,onChange:e=>{const A=parseFloat(e.target.value);T(A),e.target.style.setProperty("--fill",`${A*100}%`)},className:"custom-volume-slider"})]}),t.jsx(Z,{})]})]}),t.jsx("audio",{ref:f,muted:v,preload:"auto",loop:!0})]})};exports.LiveRadioWidget=J;
